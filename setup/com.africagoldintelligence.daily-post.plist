<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
  "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<!--
  Africa Gold Intelligence — Daily Post Orchestrator (macOS launchd)
  ──────────────────────────────────────────────────────────────────
  Runs orchestrator.py at 06:00 every day (local time).

  The orchestrator:
    • Fetches gold prices, FX rates, and news (Market Intelligence Agent)
    • Builds free + premium briefing content (Content Synthesis Agent)
    • Creates a DRAFT post on Beehiiv — never auto-sends (Distribution Agent)
    • Emails you a notification with a review link (Human Oversight Gate)
    • Logs every run to run_log.jsonl

  INSTALL (one time):
    bash install_scheduler.sh

  TEST (runs immediately):
    launchctl start com.africagoldintelligence.daily-post

  DRY RUN (no Beehiiv post):
    python3 /Users/jotetaddese/Documents/GoldBriefing/orchestrator.py --dry-run

  VIEW LOGS:
    tail -f /tmp/agi_post.log
    python3 /Users/jotetaddese/Documents/GoldBriefing/orchestrator.py --log

  UNLOAD:
    launchctl unload ~/Library/LaunchAgents/com.africagoldintelligence.daily-post.plist
-->
<plist version="1.0">
<dict>

  <key>Label</key>
  <string>com.africagoldintelligence.daily-post</string>

  <!-- Run orchestrator.py (Tier 0 — coordinates all Phase 1 agents) -->
  <key>ProgramArguments</key>
  <array>
    <string>/usr/bin/python3</string>
    <string>/Users/jotetaddese/Documents/GoldBriefing/orchestrator.py</string>
  </array>

  <!-- Run at 06:00 every day (local time) -->
  <key>StartCalendarInterval</key>
  <dict>
    <key>Hour</key>
    <integer>6</integer>
    <key>Minute</key>
    <integer>0</integer>
  </dict>

  <key>EnvironmentVariables</key>
  <dict>
    <!-- Required: get from https://app.beehiiv.com/settings/api -->
    <key>BEEHIIV_API_KEY</key>
    <string>REPLACE_WITH_YOUR_API_KEY</string>

    <key>BEEHIIV_PUB_ID</key>
    <string>pub_5927fa56-6b7c-4310-8f35-2ff9d18f523b</string>

    <!--
      IMPORTANT: Orchestrator always overrides this to "draft".
      This env var is kept for compatibility but has no effect.
    -->
    <key>AGI_PUBLISH_TYPE</key>
    <string>draft</string>

    <!--
      Notifications: Gmail App Password for operator alerts.
      Get one at: https://myaccount.google.com/apppasswords
      Alternatively: launchctl setenv NOTIFY_PASSWORD "your_app_password"
    -->
    <key>NOTIFY_PASSWORD</key>
    <string>REPLACE_WITH_GMAIL_APP_PASSWORD</string>

    <key>NOTIFY_EMAIL</key>
    <string>jote.taddese@gmail.com</string>

    <key>PATH</key>
    <string>/usr/local/bin:/usr/bin:/bin:/opt/homebrew/bin</string>

    <key>HOME</key>
    <string>/Users/jotetaddese</string>
  </dict>

  <!-- stdout and stderr logs -->
  <key>StandardOutPath</key>
  <string>/tmp/agi_post.log</string>

  <key>StandardErrorPath</key>
  <string>/tmp/agi_post_error.log</string>

  <!-- Do NOT run at load — only at scheduled time (or manual trigger) -->
  <key>RunAtLoad</key>
  <false/>

</dict>
</plist>
